#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=15_Gates_of_Kharos
    next_scenario=16_The_City_of_Light
    name= _ "Gates of Kharos"
    map_data="{~add-ons/To_Lands_Unknown/maps/15_GatesofKharos.map}"
    turns=-1
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {EXTRA_SCENARIO_MUSIC casualties_of_war.ogg}
    {AFTERNOON}

    [event]
        name = preload
        first_time_only = no
        [lua]
            code=<< main = wesnoth.dofile("~add-ons/To_Lands_Unknown/lua/animation.lua") >>
        [/lua]
    [/event]

    {STORYTXT_GATES_OF_KHAROS}

    {STARTING_VILLAGES_ALL 2}

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Mehir_Leader
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes
        profile=portraits/mehir.png

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Summoner,EoMa_Rhami,EoMa_Fire_Elemental,EoMa_Dispeller

        {GOLD 1000 750 500}
        {INCOME 10 5 0}

        {UNIT 1 (EoMa_Master_of_Sun) () () (placement=leader
        id=Atiros
        {IS_HERO}
        name=Atiros)}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Master of Darkness"
        type=EoMa_Master_of_Darkness
        name= _ "Master of Darkness"
        id=Master
        unrenamable=yes
        canrecruit=yes
        color=black

        recruit=EoMa_Disciple,EoMa_Dark_Wizard,EoMa_Dark_Witch,EoMa_Raging_Hydra

        [ai]
            #recruitment_pattern=archer,archer,fighter,mixed fighter,mixed fighter,scout
            aggression=1.0
        [/ai]

        {GOLD 700 850 1000}
        {INCOME 2 5 10}

        {UNIT 2 (EoMa_Great_Warlock) 17 23 (ai_special=guardian)}
        {UNIT 2 (EoMa_Great_Warlock) 21 23 (ai_special=guardian)}
        {UNIT 2 (EoMa_General) 17 25 (ai_special=guardian)}
        {UNIT 2 (EoMa_General) 21 25 (ai_special=guardian)}
        {UNIT 2 (EoMa_Chaos_Hydra) 18 22 (ai_special=guardian)}
        {UNIT 2 (EoMa_Chaos_Hydra) 20 22 (ai_special=guardian)}
        {UNIT 2 (EoMa_Chaos_Hydra) 18 25 (ai_special=guardian)}
        {UNIT 2 (EoMa_Chaos_Hydra) 20 25 (ai_special=guardian)}
        {UNIT 2 (EoMa_Matriarch_of_Darkness) 14 23 (ai_special=guardian)}
        {UNIT 2 (EoMa_Matriarch_of_Darkness) 24 23 (ai_special=guardian)}
    [/side]
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Raging_Hydra) 4}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Dark_Wizard) 6}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (EoMa_Disciple) 3}

    [side]
        side=3
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Master of War"
        type=EoMa_Master_of_War
        unrenamable=yes
        canrecruit=yes
        color=purple

        recruit=EoMa_Dark_Warrior,EoMa_Hydra,Vampire Bat,Blood Bat,EoMa_Commander,EoMa_Dark_Slayer

        [ai]
            #recruitment_pattern=archer,archer,fighter,mixed fighter,mixed fighter,scout
            aggression=1.0
        [/ai]

        {GOLD 300 450 600}
        {INCOME 2 5 10}
    [/side]

    [side]
        side=4
        controller=ai
        team_name=tharis
        user_team_name= _ "team_name^Master of Battle"
        type=EoMa_Master_of_War
        unrenamable=yes
        canrecruit=yes
        color=blue

        recruit=EoMa_Dark_Warrior,EoMa_Dark_Hunter,EoMa_Bladedancer,EoMa_Great_Hunter,EoMa_Dark_Assassin,EoMa_Sworddancer

        [ai]
            #recruitment_pattern=archer,archer,fighter,mixed fighter,mixed fighter,scout
            aggression=1.0
        [/ai]

        {GOLD 300 450 600}
        {INCOME 2 5 10}
    [/side]

    [side]
        side=5
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Dedylos"

        type=EoMa_Platinum_Warrior
        id=Dedylos
        name= _ "Dedylos"
        unrenamable=yes
        canrecruit=yes
        color=white

        recruit=EoMa_White_Warrior,EoMa_Protector,EoMa_Brown_Warrior,EoMa_Shielder,EoMa_Cavalry_Archer,EoMa_Sun_Follower

        [ai]
            aggression=0.2
            #grouping=defensive
        [/ai]
        {GOLD 700 500 500}
        {INCOME 10 5 2}

        {UNIT 5 (EoMa_Silver_Warrior) 13 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 13 2 ()}
        {UNIT 5 (EoMa_Silver_Warrior) 13 3 ()}
        {UNIT 5 (EoMa_Silver_Warrior) 13 4 ()}

        {UNIT 5 (EoMa_Silver_Warrior) 25 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Silver_Warrior) 25 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Protector) 14 1 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 14 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Protector) 24 1 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Protector) 24 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Revenger) 12 1 (upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 12 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 12 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 12 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Revenger) 26 1 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 26 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 26 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Revenger) 26 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Sun_Follower) 11 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 2 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 3 (upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 11 4 (upkeep=loyal)}

        {UNIT 5 (EoMa_Sun_Follower) 27 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 2 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 3 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Sun_Follower) 27 4 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 9 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 9 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 9 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 9 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 29 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 29 7 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 8 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 8 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 8 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 8 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_Shielder) 30 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Shielder) 30 7 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_White_Warrior) 7 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 7 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 7 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 7 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_White_Warrior) 31 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_White_Warrior) 31 7 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Cleric) 5 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 5 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 5 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 5 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_Cleric) 33 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Cleric) 33 7 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Inspired) 4 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 4 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 4 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 4 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_Inspired) 34 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Inspired) 34 7 (facing=sw
        upkeep=loyal)}

        {UNIT 5 (EoMa_Adept_of_Light) 3 4 (upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 5 (upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 6 (upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 3 7 (upkeep=loyal)}

        {UNIT 5 (EoMa_Adept_of_Light) 35 4 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 5 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 6 (facing=sw
        upkeep=loyal)}
        {UNIT 5 (EoMa_Adept_of_Light) 35 7 (facing=sw
        upkeep=loyal)}
    [/side]

    [side]
        side=6
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Kharos"

        type=EoMa_Prophet_of_Light
        id=Anthi
        name= _ "Anthi"
        unrenamable=yes
        canrecruit=yes
        color=white
        profile=portraits/anthi.png

        recruit=EoMa_White_Warrior,EoMa_Protector,EoMa_Brown_Warrior,EoMa_Shielder,EoMa_Cavalry_Archer,EoMa_Sun_Follower

        {GOLD 400 300 200}
        {INCOME 10 5 0}

        {UNIT 6 (EoMa_Kirios) 5 9 (name= _ "Bodyguard"
        unrenamable=yes)}

        {UNIT 6 (EoMa_Golden_Warrior) 7 9 (id=Adviser
        name= _ "Adviser")}

        {UNIT 6 (EoMa_Platinum_Warrior) 19 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Platinum_Warrior) 19 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Brown_Warrior) 18 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 18 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Brown_Warrior) 20 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Brown_Warrior) 20 6 (moves,max_moves=0,0)}

        {UNIT 6 (EoMa_Sun_Guardian) 21 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 21 6 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 2 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 3 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 4 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 5 (moves,max_moves=0,0)}
        {UNIT 6 (EoMa_Sun_Guardian) 17 6 (moves,max_moves=0,0)}
    [/side]

    [event]
        name=prestart
        [recall]
            id=Rashti
        [/recall]
        #{PLACE_HALO "scenery/gate0.png" 19 14}
        {PLACE_HALO "scenery/gatekharos0.png" 19 9}
        {PLACE_HALO "scenery/wall.png" 6 9}
        {PLACE_HALO "scenery/kharos-soldiers.png" 19 4}
    [/event]

    [event]
        name=start
        [store_unit]
            [filter]
                side=5
            [/filter]
            variable=army
        [/store_unit]
        {FOREACH army i}
            {VARIABLE army[$i].moves 0}
            {VARIABLE army[$i].max_moves 0}
            [unstore_unit]
                variable=army[$i]
                find_vacant=no
            [/unstore_unit]
        {NEXT i}
        [message]
            speaker=Mehir
            message= _ "We’re a bit too late."
        [/message]
        {SCROLL_TO 19 24}
        [delay]
            time=500
        [/delay]
        {SCROLL_TO 19 4}
        [delay]
            time=500
        [/delay]
        [message]
            speaker=Anthi
            message= _ "There are too many of them. This day had to come..."
        [/message]
        [message]
            speaker=Adviser
            message= _ "Don’t lose hope, Anthi. These walls have protected our peoples for centuries; nothing can destroy our gates."
        [/message]
        [message]
            speaker=Anthi
            message= _ "Atiros has not come back..."
        [/message]
        [message]
            speaker=Adviser
            message= _ "I’m not sure whether he returned or not, but I can see an army in the distance. They must be troops from Saffaros, and those beside them... They don’t look like the warriors of Kharos, but they’re not of the invaders either..."
        [/message]
        [message]
            speaker=Anthi
            message= _ "Is this... Can it be true? They... exist? I can’t feel them because of this dark aura..."
        [/message]

        [message]
            speaker=Dedylos
            message=_ "Strange. The enemy always attacked by night, but this time is different. I have bad feelings about this."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Don’t forget they are surrounded. We have the surprise, and they won’t survive this."
        [/message]
        [message]
            speaker=Atiros
            message=_ "Be not hasty. A vile foe violates us all."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Defeat the invaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Rashti"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Atiros"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dedylos"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=side 2 turn 2
        [message]
            canrecruit=yes
            side=4
            message= _ "Master, the human armies rounded us from the east. The desert wizards are with them. We are in a trap."
        [/message]
        [message]
            speaker=Master
            message= _ "Finally. Now it’s time for a REAL BLOODBATH!!!"
        [/message]
        [message]
            speaker=Master
            message= _ "...SIRAHT THES SORUTH..."
        [/message]
        {SCROLL_TO 19 13}
        [sound]
            name=magic-dark-big.ogg
        [/sound]
        {FAKE_SCENERY_ANIM scenery/implosion 10 19 13 100}
        [sound]
            name=explosion.ogg
        [/sound]
        {FAKE_SCENERY_ANIM scenery/dust 6 19 9 100}

        {FAKE_SCENERY_ANIM scenery/gate-kharos 14 19 12 100}
        {PLACE_HALO "scenery/gate-top0.png" 19 9}
        {REMOVE_IMAGE 19 4}
        [delay]
            time=1000
        [/delay]
        {EARTHQUAKE (
            [kill]
                x=17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,17,18,19,20,21,
                y=2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6
                animate=no
            [/kill])}
            [delay]
                time=1000
            [/delay]
            {SCROLL_TO 19 4}
            [delay]
                time=2000
            [/delay]
            {PLACE_HALO "scenery/gate_shadow.png" 19 15}
            [message]
                speaker=Anthi
                message= _ "!!!"
            [/message]
            [message]
                speaker=Adviser
                message= _ "Our indestructible gates... Our best soldiers..."
            [/message]
            [message]
                speaker=Dedylos
                message= _ "What are the limits of that hated voice, whose mere sound tears the thickest walls?!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "It’s nothing. Hope they won’t throw buildings on us..."
            [/message]
            [message]
                speaker=Dedylos
                message= _ "!"
            [/message]
            [message]
                speaker=Anthi
                message= _ "Those apostles of death cannot enter our capital. Let our soldiers attack!"
            [/message]
            {FOREACH army i}
                {VARIABLE army[$i].moves 5}
                {VARIABLE army[$i].max_moves 5}
                [unstore_unit]
                    variable=army[$i]
                    find_vacant=no
                [/unstore_unit]
            {NEXT i}
            {CLEAR_VARIABLE army}
        [/event]

        [event]
            name=side 2 turn 6
            [message]
                speaker=Master
                message= _ "The fools are coming... FALL!"
            [/message]

            {REMOVE_IMAGE 19 9}
            {REMOVE_IMAGE 19 15}
            {SCROLL_TO 19 13}
            [sound]
                name=explosion.ogg
            [/sound]
            {FAKE_SCENERY_ANIM scenery/top-fall 11 19 12 100}
            {FAKE_SCENERY_ANIM scenery/top-end 6 19 13 150}
            {PLACE_HALO "scenery/top-end0.png" 19 13}
            {EARTHQUAKE ()}
            [kill]
                x=16-22,21
                y=14-17,18
                animate=no
            [/kill]
            [terrain]
                terrain=Rp^Xo
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]
        [/event]

        #master's death events
        [event]
            name=last breath

            [filter]
                id=Master
            [/filter]

            [message]
                speaker=Master
                message= _ "HAHAHAAAAAhaa!!! You’re pitiful."
            [/message]
            [gold]
                side=3
                amount=600
            [/gold]
            [gold]
                side=4
                amount=600
            [/gold]
            [store_unit]
                [filter]
                    x,y=$x1,$y1
                [/filter]
                variable=mastervar
                kill=yes
            [/store_unit]
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
            {UNIT 2 (Dread Bat) ($x1) ($y1) ()}
        [/event]

        [event]
            name=die
            first_time_only=no
            [filter]
                type=Dread Bat
            [/filter]

            [if]
                [have_unit]
                    type=Dread Bat
                [/have_unit]
                [else]
                    [unstore_unit]
                        variable=mastervar
                        x,y=25,6
                    [/unstore_unit]
                    {FULL_HEAL id=Master}
                    {CLEAR_VARIABLE mastervar}
                    [message]
                        speaker=Master
                        message=_ "Fear! I feel your fear! It’s overwhelming but understandable. I have slaughtered thousands of your people and now it’s time for you to die."
                    [/message]
                    [message]
                        speaker=Master
                        message= _ "Your stupid religion won’t save you like it didn’t save the others. So before you die, I will give you a chance. The chance to revolt against your false religion and the hypocrites which are ordering you to die! You must choose whether to die in a honorable way or to die in fear!"
                    [/message]
                    [message]
                        speaker=Anthi
                        message= _ "Don’t listen to him! The Sun is with us!"
                    [/message]
                    {VARIABLE turn_master $turn_number}
                    {VARIABLE turn_master2 $turn_number}
                    {VARIABLE turn_master3 $turn_number}
                    {VARIABLE_OP turn_master2 add 15}
                    {VARIABLE_OP turn_master3 add 2}
                    [message]
                        speaker=Mehir
                        message= _ "Rashti, can you reach him?"
                    [/message]
                    [message]
                        speaker=Rashti
                        message= _ "Yes."
                    [/message]
                    [message]
                        speaker=Mehir
                        message= _ "So kill him!"
                    [/message]
                    {PLACE_IMAGE "items/gohere.png" 19 19}
                    {HIGHLIGHT_IMAGE 19 19 "items/gohere.png" ()}
                [/else]
            [/if]
        [/event]

        [event]
            name=side 2 turn
            first_time_only=no
            [if]
                [variable]
                    name=turn_number
                    greater_than_equal_to=$turn_master
                [/variable]
                [and]
                    [variable]
                        name=turn_number
                        less_than=$turn_master2
                    [/variable]
                [/and]
                [then]
                    [store_unit]
                        [filter]
                            side=5
                            x=1-37
                            y=1-14
                            type=EoMa_Shielder,EoMa_Protector,EoMa_Revenger,EoMa_White_Warrior,I8 Kharos_SunSilverWarrior
                        [/filter]
                        variable=corrupted
                    [/store_unit]
                    {RANDOM 0..$corrupted.length}
                    {VARIABLE corrupted[$random].side 2}
                    [unstore_unit]
                        variable=corrupted[$random]
                        find_vacant=no
                    [/unstore_unit]
                    {SCROLL_TO $corrupted[$random].x $corrupted[$random].y}
                    {FAKE_SCENERY_ANIM scenery/blackcloud 5 $corrupted[$random].x $corrupted[$random].y 100}
                    {REVERSE_SCENERY_ANIM scenery/blackcloud 5 $corrupted[$random].x $corrupted[$random].y 100}
                    {CLEAR_VARIABLE random}

                    {RANDOM 0..$corrupted.length}
                    {SCROLL_TO $corrupted[$random].x $corrupted[$random].y}
                    {FAKE_SCENERY_ANIM scenery/blackcloud 5 $corrupted[$random].x $corrupted[$random].y 100}
                    [if]
                        [variable]
                            name=turn_number
                            equals=$turn_master3
                        [/variable]
                        [then]
                            [message]
                                id=$corrupted.id
                                message= _ "No! I won’t betray my country! I will never turn against my religion! You won’t take my soul, you demon!"
                            [/message]
                            [message]
                                id=Master
                                message= _ "Oh, look! A brave one! When I come down, I am going to kill you slowly..."
                            [/message]
                        [/then]
                        [else]
                            {VARIABLE corrupted[$random].side 2}
                        [/else]
                    [/if]
                    [unstore_unit]
                        variable=corrupted[$random]
                        find_vacant=no
                    [/unstore_unit]
                    {REVERSE_SCENERY_ANIM scenery/blackcloud 5 $corrupted[$random].x $corrupted[$random].y 100}
                    {CLEAR_VARIABLE random}
                    {CLEAR_VARIABLE corrupted}
                [/then]
                [else]
                    [if]
                        [variable]
                            name=turn_number
                            equals=$turn_master2
                        [/variable]
                        [then]
                            {MODIFY_UNIT id=Adviser side 2}
                            [message]
                                speaker=Adviser
                                message= _ "Anthi, I... I’m going to kill you."
                            [/message]
                            [message]
                                speaker=Anthi
                                message= _ "No... please!"
                            [/message]
                            [animate_unit]
                                flag=attack
                                [filter]
                                    id=Adviser
                                [/filter]
                                [primary_attack]
                                    name=white sword
                                [/primary_attack]
                                hits=yes
                                #text= _ " *swoosh*"
                                #red=255
                                #green=0
                                #blue=0
                                [facing]
                                    [filter]
                                        id=Anthi
                                    [/filter]
                                [/facing]
                            [/animate_unit]
                            [kill]
                                id=Anthi
                                animate=yes
                            [/kill]
                            [endlevel]
                                result=defeat
                            [/endlevel]
                        [/then]
                    [/if]
                [/else]
            [/if]
        [/event]

        #corrupting - dialogue
        [event]
            name=attack
            [filter]
                type=EoMa_Shielder,EoMa_Protector,EoMa_Revenger,EoMa_White_Warrior,I8 Kharos_SunSilverWarrior
            [/filter]
            [filter_second]
                type=EoMa_Shielder,EoMa_Protector,EoMa_Revenger,EoMa_White_Warrior,I8 Kharos_SunSilverWarrior,EoMa_Adept_of_Light,EoMa_Cleric,EoMa_Inspired
            [/filter_second]

            [message]
                speaker=unit
                message=_ "You lied to us, Anthi. We’ve lost everything and the Sun has abandoned us. That’s why I choose the night! Fight with me people! We must destroy this false religion and those who protect it!"
            [/message]

            [event]
                name=attack end
                [message]
                    speaker=Master
                    message= _ "Mwhahaha! I want to see more! MORE!!"
                [/message]
                [message]
                    speaker=Anthi
                    message= _ "Our soldiers! He is rending their souls! They are turning against us! It’s impossible!"
                [/message]
            [/event]
        [/event]

        [event]
            name=moveto
            [filter]
                id=Rashti
                x,y=19,19
            [/filter]

            [if]
                [have_unit]
                    id=Master
                    x,y=25,6
                [/have_unit]
                [then]
                    {REMOVE_IMAGE 19 19}
                    {SCROLL_TO 19 16}
                    [store_unit]
                        [filter]
                            id=Rashti
                        [/filter]
                        kill=yes
                    [/store_unit]
                    [redraw]
                    [/redraw]
                    {FAKE_SCENERY_ANIM scenery/climb-a 14 19 16 75}
                    {PLACE_HALO "scenery/climb-a-14.png" 19 16}
                    {SCROLL_TO 19 11}
                    {REMOVE_IMAGE 19 16}
                    {FAKE_SCENERY_ANIM scenery/climb-b 16 19 11 75}
                    {PLACE_HALO "scenery/climb-b-16.png" 19 11}
                    {REMOVE_IMAGE 19 11}
                    {FAKE_SCENERY_ANIM scenery/climb-c 8 19 7 75}
                    {PLACE_HALO "scenery/climb-c-8.png" 19 7}
                    [message]
                        speaker=Adviser
                        message= _ "Protect the Highest Priestess!"
                    [/message]
                    {SCROLL_TO 19 7}
                    {REMOVE_IMAGE 19 7}
                    [animate_path]
                        x=-1175,200,600,1100
                        y=200,-60,-60,200
                        hex_x,hex_y=13,6
                        image=anim/climb-d.png
                        frames=20
                        frame_length=75
                        interpolation=bspline
                        linger=yes
                    [/animate_path]
                    [delay]
                        time=500
                    [/delay]
                    {FADE_TO_BLACK}
                    [message]
                        speaker=Master
                        message=_ "You. You are not from here. You are not from this world, either. You are a slave, far more powerful than your masters. It’s time for you to choose: to serve or be free! Decide NOW!"
                    [/message]
                    [animate_unit]
                        flag=attack
                        [filter]
                            id=Master
                        [/filter]
                        [primary_attack]
                            name=scythe
                        [/primary_attack]
                        hits=yes
                        #text= _ " *swoosh*"
                        #red=255
                        #green=0
                        #blue=0
                        [facing]
                            [filter]
                                id=Anthi
                            [/filter]
                        [/facing]
                    [/animate_unit]
                    #[sound]
                    #    name={SOUND_LIST:SWORD_SWISH}
                    #[/sound]
                    #{FAKE_SCENERY_ANIM scenery/climb-e 9 19 7 75}
                    {PLACE_HALO "scenery/white.png" 19 7}
                    {REMOVE_IMAGE 19 7}
                    {REMOVE_IMAGE 24 5}
                    {FADE_STEP 192 5}
                    {FADE_STEP 160 5}
                    {FADE_STEP 128 5}
                    {FADE_STEP 96 5}
                    {FADE_STEP 64 5}
                    {FADE_STEP 32 5}
                    {FADE_STEP 0 5}
                    [message]
                        speaker=Mehir
                        message= _ "Rashti?... No, it’s impossible. This is another illusion, it can’t happen. She can’t die."
                    [/message]
                    #{PLACE_HALO "scenery/dharmarashti-dead.png" 18 16}
                    #{PLACE_IMAGE "scenery/horashti-dead.png" 6 19}
                    #{SCROLL_TO 18 16}
                    #[delay]
                    #    time=1000
                    #[/delay]
                    #{SCROLL_TO 6 19}
                    #[delay]
                    #    time=1000
                    #[/delay]
                    [message]
                        speaker=Master
                        message= _ "Is that all you have to show me? I am disappointed."
                    [/message]
                    [message]
                        speaker=Dedylos
                        message= _ "She’s dead. I’m sorry, Mehir..."
                    [/message]
                    [message]
                        speaker=Mehir
                        message= _ "One of the ultimate beings no longer exists. The balance between worlds has been disturbed. If the Highest Council will hear about that, they will kill me..."
                    [/message]
                    #{VARIABLE_OP turn_master2 add 99}
                    [fire_event]
                        name=resurrection
                    [/fire_event]
                [/then]
            [/if]
        [/event]

        [event]
            name=resurrection
            {UNIT 2 (TLU_DharmaRashti) 25 4 ()}
            {UNIT 1 (TLU_HoRashti) 13 4 ()}

            [message]
                type=TLU_HoRashti
                message= _ "It is not..."
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "...OVER YET!!!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Rashti? You’re alive?! Both of you?"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "My irrational, angry self is no longer a part of me. The Abyss is free to move away from the path of hate."
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "I WILL NEVER BE YOUR SERVANT AGAIN, SUMMONERS!!! I AM FREE!!!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "It’s a miracle. Even Nomolas couldn’t do such a thing. But Dharma’rashti is out of control. What do we do?"
            [/message]
            [message]
                type=TLU_HoRashti
                message= _ "For the good of all enlightened beings, I must kill her."
            [/message]
            [message]
                type=TLU_DharmaRashti
                message= _ "KILL HER!!!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Oh no! Whichever half wins the Council will surely kill me."
            [/message]
            [objectives]
                side=1
                [objective]
                    description= _ "Defeat the invaders"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Use Ho’rashti to defeat Dharma’rashti"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Mehir"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Dedylos"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Atiros"
                    condition=lose
                [/objective]
            [/objectives]
        [/event]

        #path cleaner
        [event]
            name=moveto
            first_time_only=yes
            [filter]
                type=TLU_HoRashti
                [filter_adjacent]
                    [filter_adjacent]
                        type=TLU_DharmaRashti
                    [/filter_adjacent]
                [/filter_adjacent]
            [/filter]

            [message]
                type=TLU_DharmaRashti
                message= _ "GET OUT OF MY WAY, HUMANS! THIS IS THE DUEL BETWEEN ME AND HER!!!"
            [/message]

            [kill]
                [filter_adjacent]
                    type=TLU_HoRashti
                [/filter_adjacent]
                [and]
                    [filter_adjacent]
                        type=TLU_DharmaRashti
                    [/filter_adjacent]
                [/and]
                animate=yes
            [/kill]
        [/event]

        [event]
            name=truerashti unified
            {MODIFY_UNIT (type=TLU_True_Rashti) canrecruit yes}
            [message]
                type=TLU_True_Rashti
                message= _ "Finally I am UNITY!"
            [/message]
            [message]
                speaker=Master
                message= _ "Amazing. I have split her in half, and she is still alive. She has also changed the color of her hair! It’s time to kill you for s..."
            [/message]

            {SCROLL_TO 19 13}
            [terrain]
                terrain=Rp
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]
            {EARTHQUAKE ()}
            {REMOVE_IMAGE 19 13}
            {REVERSE_SCENERY_ANIM scenery/top-end 6 19 13 150}
            {REVERSE_SCENERY_ANIM scenery/top-fall 11 19 12 100}
            {PLACE_HALO "scenery/gate-top0.png" 19 9}
            [sound]
                name=explosion.ogg
            [/sound]
            [message]
                speaker=Master
                message= _ "What is the meaning of this?!"
            [/message]
            [store_unit]
                [filter]
                    type=TLU_True_Rashti
                [/filter]
                variable=truerashtivar
                kill=yes
            [/store_unit]
            {VARIABLE truerashtivar.id Rashti}
            {SCROLL_TO ($truerashtivar.x) ($truerashtivar.y)}
            [delay]
                time=500
            [/delay]
            [message]
                speaker=Master
                message= _ "Where is this bi..."
            [/message]
            {FAKE_SCENERY_ANIM scenery/rev-a 4 25 4 100}
            [sound]
                name=explosion.ogg
            [/sound]
            {PLACE_HALO "scenery/rev-a-5.png" 25 4}
            [kill]
                id=Master
                animate=no
            [/kill]
            [redraw]
            [/redraw]
            [delay]
                time=1000
            [/delay]
            {FAKE_SCENERY_ANIM scenery/rev-b 10 25 4 50}
            {PLACE_HALO "scenery/rev-b-10.png" 25 4}

            {SCROLL_TO 25 8}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            {SCROLL_TO 25 11}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            {SCROLL_TO 25 14}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=500
            [/delay]
            {SCROLL_TO 25 17}
            [sound]
                name=explosion.ogg
            [/sound]
            [delay]
                time=250
            [/delay]
            [sound]
                name=explosion.ogg
            [/sound]
            {FAKE_SCENERY_ANIM scenery/rev-c 8 19 17 100}
            {PLACE_HALO "scenery/rev-c-8.png" 19 17}
            [unstore_unit]
                variable=truerashtivar
                x,y=22,17
            [/unstore_unit]
            [delay]
                time=500
            [/delay]
            {MOVE_UNIT id=Rashti 19 20}
            [message]
                speaker=Rashti
                message= _ "Die..."
            [/message]
            {SCROLL_TO 19 13}
            [sound]
                name=explosion.ogg
            [/sound]
            {REMOVE_IMAGE 19 9}
            {FAKE_SCENERY_ANIM scenery/top-fall 11 19 12 100}
            {FAKE_SCENERY_ANIM scenery/top-end 6 19 13 150}
            {PLACE_HALO "scenery/top-end0.png" 19 13}
            {EARTHQUAKE ()}
            [kill]
                x=16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,21
                y=14,14,14,14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17,18
                animate=no
            [/kill]
            [terrain]
                terrain=Rp^Xo
                x=16,17,18,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22,16,17,18,19,20,21,22
                y=14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17
            [/terrain]

            [message]
                speaker=Mehir
                message= _ "Ra..Rashti... you’ve changed, but your character is still the same. Thank you!"
            [/message]
            [message]
                speaker=Rashti
                message= _ "I have achieved harmony. Two egos have become one. This is my true and last character."
            [/message]
            {MODIFY_UNIT (side=2
            type=EoMa_Shielder,EoMa_Protector,EoMa_Revenger,EoMa_White_Warrior,I8 Kharos_SunSilverWarrior,EoMa_Adept_of_Light,EoMa_Cleric,EoMa_Inspired
        ) side 5}
        [message]
            speaker=Anthi
            message= _ "Thank Sun! My soldiers are recovering consciousness!"
        [/message]
        {VARIABLE turn_master2 0}
        [if]
            [have_unit]
                side=2,3,4
            [/have_unit]
            [then]
                [message]
                    speaker=Dedylos
                    message= _ "You’ll talk later; we have a job to do. Their leader is dead, but they haven’t given up yet."
                [/message]
            [/then]
            [else]
                [endlevel]
                    result=victory
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=victory
        {REPLACE_SCENARIO_MUSIC wanderer.ogg}
        [message]
            speaker=Atiros
            message=_ "Anthi, we have come. From across the sea, we have come!"
        [/message]
        [message]
            speaker=Anthi
            message=_ "The dark aura has gone. Atiros, I sent you with nothing and you came with victory. May Sun bestow you with infinite Light."
        [/message]
        [message]
            speaker=Atiros
            message=_ "Thank our legendary brothers from the Great Desert. This is Mehir, our rescuer."
        [/message]
        [message]
            speaker=Anthi
            message= _ "Welcome in Kharos, Mehir, descendant of our fathers."
        [/message]
        [message]
            speaker=Mehir
            message= _ "So you are Anthi, The Highest Priest of Light. I can finally meet you."
        [/message]
        [message]
            speaker=Anthi
            message=_ "Yes. I ordered Atiros to find you and bring you here. Sometimes fairy tales are true.

Please, enter our city."
        [/message]
        [message]
            speaker=Mehir
            message= _ "I’m honored, but first I must send someone to al-Kamija with a report about Rashti for the Highest Council."
        [/message]
    [/event]

    [event]
        name=die
        first_time_only=no
        [filter]
            side=2,3,4
        [/filter]
        [if]
            [have_unit]
                side=2,3,4
            [/have_unit]
            [else]
                [endlevel]
                    result=victory
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=truerashti split
        [message]
            speaker=Mehir
            message= _ "Oh no! Rashti has lost her balance once again!"
        [/message]
    [/event]

    {SUMMONER_UNLOCK}
    {RASHTI_TRANSFORMATIONS 2}
    {ITEM_APPLIER}
    {COLLAR_EVENT}
    {DEATH_MEHIR}
    {DEATH_RASHTI}
    {DEATH_ATIROS}
    {DEATH_DEDYLOS}
    {I8M15_TERRAIN}
[/scenario]
